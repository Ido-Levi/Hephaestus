From ae44592ffadd3a35a88b1287011343f14d8b49cb Mon Sep 17 00:00:00 2001
From: Ido Levi <idol@ziprecruiter.com>
Date: Tue, 4 Nov 2025 12:34:19 +0200
Subject: [PATCH] [Agent ae77a238-58f3-4a71-b991-61a6d67f2f12] Checkpoint
 before spawning child

---
 django/db/models/aggregates.py | 22 ++++++++++++++++++----
 1 file changed, 18 insertions(+), 4 deletions(-)

diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py
index da4ff928aa..fdb437f41d 100644
--- a/django/db/models/aggregates.py
+++ b/django/db/models/aggregates.py
@@ -13,6 +13,20 @@ __all__ = [
 ]
 
 
+class DistinctCapableAggregate:
+    """
+    Mixin class that enables aggregates to support the distinct parameter.
+
+    This mixin sets allow_distinct = True, allowing aggregate classes to
+    use the distinct=True parameter, which generates SQL with DISTINCT
+    keyword (e.g., AVG(DISTINCT field), SUM(DISTINCT field)).
+
+    Classes using this mixin should inherit from it along with Aggregate
+    or other mixins, following Django's multiple inheritance pattern.
+    """
+    allow_distinct = True
+
+
 class Aggregate(Func):
     template = '%(function)s(%(distinct)s%(expressions)s)'
     contains_aggregate = True
@@ -96,7 +110,7 @@ class Aggregate(Func):
         return options
 
 
-class Avg(FixDurationInputMixin, NumericOutputFieldMixin, Aggregate):
+class Avg(DistinctCapableAggregate, FixDurationInputMixin, NumericOutputFieldMixin, Aggregate):
     function = 'AVG'
     name = 'Avg'
 
@@ -118,12 +132,12 @@ class Count(Aggregate):
         return 0 if value is None else value
 
 
-class Max(Aggregate):
+class Max(DistinctCapableAggregate, Aggregate):
     function = 'MAX'
     name = 'Max'
 
 
-class Min(Aggregate):
+class Min(DistinctCapableAggregate, Aggregate):
     function = 'MIN'
     name = 'Min'
 
@@ -139,7 +153,7 @@ class StdDev(NumericOutputFieldMixin, Aggregate):
         return {**super()._get_repr_options(), 'sample': self.function == 'STDDEV_SAMP'}
 
 
-class Sum(FixDurationInputMixin, Aggregate):
+class Sum(DistinctCapableAggregate, FixDurationInputMixin, Aggregate):
     function = 'SUM'
     name = 'Sum'
 
-- 
2.39.3 (Apple Git-146)

